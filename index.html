<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Napoleon Malaysia</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  background: rgb(51, 51, 51);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

/* Status bar */
#system-status {
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 9999;
  padding: 6px 10px;
  font-size: 12px;
  background: #222;
  color: #fff;
  text-align: center;
}

.online { color: #4caf50; }
.offline { color: #ff5252; }
.warning { color: #ffb300; }

/* Iframe */
iframe {
  border: none;
  width: 100%;
  height: 100%;
  margin-top: 30px;
}

/* Realtime clock */
#realtime-clock{
  position: fixed;
  top: 36px;
  left: 50%;
  transform: translateX(-50%);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:10px 14px;
  border-radius:14px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.12);
  background: linear-gradient(180deg, rgba(255,255,255,0.5), rgba(250,250,250,0.5));
  width: min(92%, 420px);
  z-index: 9998;
}

.clock-time{
  font-size: clamp(28px, 9vw, 56px);
  font-weight: 700;
  line-height:1;
}

.clock-time .secs{
  font-size: 0.55em;
  opacity:0.7;
}

.clock-time .ampm{
  font-size: 0.42em;
  margin-left: 8px;
}

.clock-date{
  font-size: clamp(12px, 3.6vw, 16px);
  color: #444;
}
</style>
</head>

<body>

<!-- SYSTEM STATUS BAR -->
<div id="system-status">
  <span id="netStatus">Checking network…</span> |
  <span id="userInfo">Detecting user…</span>
</div>

<!-- REALTIME CLOCK -->
<div id="realtime-clock" aria-live="polite">
  <div class="clock-time" id="clockTime">--:--</div>
  <div class="clock-date" id="clockDate">Loading date...</div>
</div>

<!-- MAIN APP -->
<iframe
  id="attendanceApp"
  src="https://script.google.com/macros/s/AKfycbzMNoVZt7ph3mqiKuMBIqDVW_tKluS2lWIPe8dTRjt1Y0vWu7TrnQPMEZtEOb6XREU0DQ/exec"
  loading="eager">
</iframe>

<script>
(function(){

/* =====================
   USER / DEVICE DETECT
===================== */
const userInfo = document.getElementById("userInfo");
const ua = navigator.userAgent;
const platform = navigator.platform || "Unknown OS";
const isMobile = /Android|iPhone|iPad/i.test(ua);
const browser =
  ua.includes("Chrome") ? "Chrome" :
  ua.includes("Firefox") ? "Firefox" :
  ua.includes("Safari") ? "Safari" :
  "Unknown Browser";

userInfo.textContent = `${browser} • ${platform} • ${isMobile ? "Mobile" : "Desktop"}`;

/* =====================
   NETWORK STATUS
===================== */
const netStatus = document.getElementById("netStatus");
const iframe = document.getElementById("attendanceApp");

function updateNetworkStatus() {
  if (navigator.onLine) {
    netStatus.textContent = "● Online";
    netStatus.className = "online";
  } else {
    netStatus.textContent = "● Offline – No Internet";
    netStatus.className = "offline";
  }
}

window.addEventListener("online", () => {
  updateNetworkStatus();
  reloadIframe();
});

window.addEventListener("offline", updateNetworkStatus);
updateNetworkStatus();

/* =====================
   IFRAME HEALTH CHECK
===================== */
let iframeLoaded = false;

iframe.onload = () => {
  iframeLoaded = true;
};

setTimeout(() => {
  if (!iframeLoaded) {
    netStatus.textContent = "⚠ App not responding (Server / DB / Network issue)";
    netStatus.className = "warning";
  }
}, 15000);

function reloadIframe() {
  iframeLoaded = false;
  iframe.src = iframe.src;
}

/* =====================
   REALTIME CLOCK
===================== */
const elTime = document.getElementById('clockTime');
const elDate = document.getElementById('clockDate');

function pad(n){ return n < 10 ? '0' + n : n; }

function updateClock(){
  const now = new Date();
  let hours = now.getHours();
  const mins = pad(now.getMinutes());
  const secs = pad(now.getSeconds());

  const ampm = hours >= 12 ? 'PM' : 'AM';
  hours = hours % 12;
  hours = hours ? hours : 12;

  elTime.innerHTML = `${hours}:${mins}<span class="secs">:${secs}</span><span class="ampm">${ampm}</span>`;

  const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

  elDate.textContent =
    `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
}

updateClock();
setInterval(updateClock, 1000);

/* =====================
   OPTIONAL MESSAGE FROM APP
===================== */
window.addEventListener("message", (e) => {
  if (e.data === "DB_ERROR") {
    netStatus.textContent = "❌ Database error detected";
    netStatus.className = "offline";
  }
  if (e.data === "APP_READY") {
    netStatus.textContent = "● App connected";
    netStatus.className = "online";
  }
});

})();
</script>

</body>
</html>
